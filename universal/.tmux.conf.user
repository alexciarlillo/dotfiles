# Minimal tmux configuration - Clean and non-interfering
# Focus on functionality over theming to avoid color conflicts

# -- Basic Settings ------------------------------------------------------------

# Enable 24-bit color support for proper nvim colors
set-option -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "tmux-256color"

# Fast command sequences and focus events
set -s escape-time 0
set -s focus-events on
set -sg repeat-time 500

# Increase history size
set -g history-limit 50000

# Window and pane behavior
set -g base-index 1
setw -g pane-base-index 1
setw -g automatic-rename on
set -g renumber-windows on

# -- Keybindings (WezTerm-style) ----------------------------------------------

# Leader key similar to WezTerm (using Ctrl+Space as alternative to Cmd+Shift+Space)
set -g prefix2 C-Space
bind C-Space send-prefix -2

# Clear screen and scrollback (Leader+C for clear, C = clear)
bind C send-keys C-l \; run 'sleep 0.05 && tmux clear-history'

# Split panes (like WezTerm Leader+s/v)
bind s split-window -v -c '#{pane_current_path}'
bind v split-window -h -c '#{pane_current_path}'

# New window/tab (like WezTerm Leader+t)
bind t new-window -c '#{pane_current_path}'

# Close window (like WezTerm Leader+w)
bind w confirm-before -p "kill-window #W? (y/n)" kill-window

# Close pane (like WezTerm Leader+d)  
bind d confirm-before -p "kill-pane #P? (y/n)" kill-pane

# Pane navigation - Leader + hjkl (vim-style, always reliable)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt+Shift with capital letters (often works better than lowercase)
bind -n M-H select-pane -L
bind -n M-J select-pane -D
bind -n M-K select-pane -U
bind -n M-L select-pane -R

# Window navigation (like WezTerm Ctrl+Alt+j/k)
bind -n M-C-j previous-window
bind -n M-C-k next-window

# Last window (like WezTerm Ctrl+Alt+comma)
bind -n 'M-C-,' last-window

# Window movement (like WezTerm Ctrl+Alt+h/l)
bind -n M-C-h swap-window -t -1\; select-window -t -1
bind -n M-C-l swap-window -t +1\; select-window -t +1

# Window selection by number (like WezTerm Ctrl+Alt+1-8)
bind -n M-C-1 select-window -t 1
bind -n M-C-2 select-window -t 2
bind -n M-C-3 select-window -t 3
bind -n M-C-4 select-window -t 4
bind -n M-C-5 select-window -t 5
bind -n M-C-6 select-window -t 6
bind -n M-C-7 select-window -t 7
bind -n M-C-8 select-window -t 8

# Pane resizing (like WezTerm Leader+r mode)
bind r switch-client -T resize
bind -T resize h resize-pane -L 3
bind -T resize j resize-pane -D 3
bind -T resize k resize-pane -U 3
bind -T resize l resize-pane -R 3
bind -T resize Escape switch-client -T root

# -- Mouse and Clipboard -------------------------------------------------------

# Mouse support
set -g mouse on

# Clipboard integration for macOS
set -g set-clipboard on
# Only use reattach-to-user-namespace if it's installed
if-shell 'command -v reattach-to-user-namespace >/dev/null' \
    'set-option -g default-command "reattach-to-user-namespace -l $SHELL"'

# Copy mode improvements (vi-style)
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection

# Use reattach-to-user-namespace for clipboard if available, otherwise use pbcopy directly
if-shell 'command -v reattach-to-user-namespace >/dev/null' \
    'bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"; bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"' \
    'bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"; bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"'

# -- Session Management --------------------------------------------------------

# Session creation and management
bind S command-prompt -p "New Session:" "new-session -A -s '%%'"
bind K confirm-before 'kill-session'

# -- Minimal, Clean Appearance -------------------------------------------------

# Status bar - simple and unobtrusive
set -g status-position bottom
set -g status-justify left

# Use terminal default colors to avoid conflicts
set -g status-style 'bg=default,fg=default'
set -g status-left-length 20
set -g status-right-length 50

# Simple status format
set -g status-left '#[bold][#S] '
set -g status-right ' %H:%M %d-%b'

# Window status - minimal
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format ' #I:#W '
setw -g window-status-current-style 'bold'

# Pane borders - subtle
set -g pane-border-style 'fg=brightblack'
set -g pane-active-border-style 'fg=blue'

# Message style - clean
set -g message-style 'bg=default,fg=default,bold'
set -g message-command-style 'bg=default,fg=default,bold'

# Mode style for copy mode
set -g mode-style 'bg=blue,fg=black'

# No window activity notifications (reduces clutter)
setw -g monitor-activity off
set -g visual-activity off